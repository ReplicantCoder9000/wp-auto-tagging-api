{
  "name": "WordPress Auto-Tagging",
  "description": "Automatically generate and assign AI-powered tags to new WordPress posts",
  "version": "1.0.0",
  "steps": [
    {
      "id": "trigger",
      "app": "wordpress",
      "event": "new_post",
      "title": "New Post in WordPress",
      "description": "Triggers when a new post is published in WordPress",
      "config": {
        "url": "https://yoursite.com",
        "username": "your_username",
        "password": "your_application_password",
        "post_status": "publish",
        "post_type": "post"
      },
      "output_fields": [
        {
          "key": "id",
          "label": "Post ID",
          "type": "integer"
        },
        {
          "key": "title",
          "label": "Post Title",
          "type": "string"
        },
        {
          "key": "content",
          "label": "Post Content",
          "type": "string"
        },
        {
          "key": "status",
          "label": "Post Status",
          "type": "string"
        },
        {
          "key": "tags",
          "label": "Post Tags",
          "type": "array"
        }
      ]
    },
    {
      "id": "filter",
      "app": "filter",
      "event": "filter",
      "title": "Only Continue If Post Needs Tagging",
      "description": "Filter to only process posts that are published and have no tags",
      "config": {
        "rules": [
          {
            "field": "1.status",
            "operator": "exactly_matches",
            "value": "publish"
          },
          {
            "field": "1.tags",
            "operator": "is_empty"
          }
        ],
        "logic": "and"
      }
    },
    {
      "id": "webhook",
      "app": "webhook",
      "event": "post",
      "title": "Call Auto-Tagging API",
      "description": "Send post data to the WordPress Auto-Tagging API",
      "config": {
        "url": "https://api.processfy.ai/api/auto-tag",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "wp_url": "https://yoursite.com",
          "wp_auth": "{{storage.wp_auth_base64}}",
          "post_id": "{{1.id}}",
          "title": "{{1.title}}",
          "content": "{{1.content | truncate: 500}}",
          "is_live": "yes",
          "tags": ""
        },
        "timeout": 30
      },
      "output_fields": [
        {
          "key": "status",
          "label": "Response Status",
          "type": "string"
        },
        {
          "key": "post_id",
          "label": "Post ID",
          "type": "integer"
        },
        {
          "key": "assigned_tags",
          "label": "Assigned Tags",
          "type": "array"
        },
        {
          "key": "tag_ids",
          "label": "Tag IDs",
          "type": "array"
        },
        {
          "key": "created_tags",
          "label": "Created Tags",
          "type": "array"
        },
        {
          "key": "processing_time_ms",
          "label": "Processing Time (ms)",
          "type": "integer"
        },
        {
          "key": "error_code",
          "label": "Error Code",
          "type": "string"
        },
        {
          "key": "message",
          "label": "Error Message",
          "type": "string"
        },
        {
          "key": "request_id",
          "label": "Request ID",
          "type": "string"
        }
      ]
    },
    {
      "id": "paths",
      "app": "paths",
      "event": "path",
      "title": "Handle Success or Error Response",
      "description": "Route the workflow based on API response status",
      "config": {
        "paths": [
          {
            "name": "Success",
            "rules": [
              {
                "field": "3.status",
                "operator": "exactly_matches",
                "value": "success"
              }
            ]
          },
          {
            "name": "Error",
            "rules": [
              {
                "field": "3.status",
                "operator": "exactly_matches",
                "value": "error"
              }
            ]
          }
        ]
      }
    },
    {
      "id": "log_success",
      "app": "google_sheets",
      "event": "create_spreadsheet_row",
      "title": "Log Success to Google Sheets",
      "description": "Log successful tagging operation to Google Sheets",
      "path": "Success",
      "config": {
        "spreadsheet_id": "YOUR_GOOGLE_SHEET_ID",
        "worksheet": "Logs",
        "values": {
          "Timestamp": "{{zap_meta_utc_iso}}",
          "Post ID": "{{1.id}}",
          "WordPress URL": "https://yoursite.com",
          "Assigned Tags": "{{3.assigned_tags | join: ', '}}",
          "Processing Time (ms)": "{{3.processing_time_ms}}",
          "AI Retries": "0",
          "Status": "success",
          "Error Code": "",
          "Error Message": "",
          "Request ID": "{{3.request_id}}"
        }
      }
    },
    {
      "id": "notify_success",
      "app": "email",
      "event": "send_email",
      "title": "Send Success Notification",
      "description": "Send email notification for successful tagging",
      "path": "Success",
      "config": {
        "to": "admin@yoursite.com",
        "subject": "WordPress Post Successfully Tagged",
        "body": "Post '{{1.title}}' (ID: {{1.id}}) has been successfully tagged with: {{3.assigned_tags | join: ', '}}\n\nProcessing time: {{3.processing_time_ms}}ms\nCreated new tags: {{3.created_tags | join: ', '}}\n\nView post: https://yoursite.com/?p={{1.id}}"
      }
    },
    {
      "id": "log_error",
      "app": "google_sheets",
      "event": "create_spreadsheet_row",
      "title": "Log Error to Google Sheets",
      "description": "Log failed tagging operation to Google Sheets",
      "path": "Error",
      "config": {
        "spreadsheet_id": "YOUR_GOOGLE_SHEET_ID",
        "worksheet": "Logs",
        "values": {
          "Timestamp": "{{zap_meta_utc_iso}}",
          "Post ID": "{{1.id}}",
          "WordPress URL": "https://yoursite.com",
          "Assigned Tags": "",
          "Processing Time (ms)": "",
          "AI Retries": "",
          "Status": "error",
          "Error Code": "{{3.error_code}}",
          "Error Message": "{{3.message}}",
          "Request ID": "{{3.request_id}}"
        }
      }
    },
    {
      "id": "alert_error",
      "app": "email",
      "event": "send_email",
      "title": "Send Error Alert",
      "description": "Send email alert for failed tagging",
      "path": "Error",
      "config": {
        "to": "admin@yoursite.com",
        "subject": "WordPress Auto-Tagging Failed",
        "body": "Auto-tagging failed for post '{{1.title}}' (ID: {{1.id}})\n\nError Code: {{3.error_code}}\nError Message: {{3.message}}\nRequest ID: {{3.request_id}}\n\nPlease check the API status and WordPress configuration.\n\nPost URL: https://yoursite.com/?p={{1.id}}"
      }
    }
  ],
  "storage": [
    {
      "key": "wp_auth_base64",
      "description": "Base64 encoded WordPress credentials (username:application_password)",
      "example": "dXNlcm5hbWU6YWJjZC1lZmdoLWlqa2wtbW5vcA=="
    }
  ],
  "setup_instructions": [
    "1. Create WordPress Application Password in your WordPress admin",
    "2. Encode credentials as Base64: echo -n 'username:password' | base64",
    "3. Store encoded credentials in Zapier Storage as 'wp_auth_base64'",
    "4. Replace 'YOUR_GOOGLE_SHEET_ID' with your actual Google Sheets ID",
    "5. Update email addresses in notification steps",
    "6. Test the workflow with a sample WordPress post"
  ],
  "requirements": [
    "WordPress site with Application Passwords enabled",
    "WordPress Auto-Tagging API deployed and configured",
    "Google Sheets for logging (optional)",
    "Email account for notifications (optional)"
  ],
  "notes": [
    "This workflow only processes posts that are published and have no existing tags",
    "Content is truncated to 500 characters for optimal AI processing",
    "Error handling includes retry logic and comprehensive logging",
    "All operations are logged to Google Sheets for monitoring and billing"
  ]
}